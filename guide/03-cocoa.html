<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OSX开发入门和OC基础 | Desgin To Release Workflow</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="docs for d2r project">
    
    <link rel="preload" href="/docs/assets/css/0.styles.318dbe0e.css" as="style"><link rel="preload" href="/docs/assets/js/app.7c0eddc4.js" as="script"><link rel="preload" href="/docs/assets/js/2.fb0ab628.js" as="script"><link rel="preload" href="/docs/assets/js/3.1ec2467f.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.7d6528ae.js"><link rel="prefetch" href="/docs/assets/js/11.fbd3039b.js"><link rel="prefetch" href="/docs/assets/js/12.6d9630c1.js"><link rel="prefetch" href="/docs/assets/js/13.b1a5aa06.js"><link rel="prefetch" href="/docs/assets/js/14.495090c1.js"><link rel="prefetch" href="/docs/assets/js/15.b6e6db0e.js"><link rel="prefetch" href="/docs/assets/js/16.52ceb8c2.js"><link rel="prefetch" href="/docs/assets/js/17.a754c857.js"><link rel="prefetch" href="/docs/assets/js/18.8f49f83d.js"><link rel="prefetch" href="/docs/assets/js/19.431e454f.js"><link rel="prefetch" href="/docs/assets/js/20.99145a82.js"><link rel="prefetch" href="/docs/assets/js/4.6220c9e8.js"><link rel="prefetch" href="/docs/assets/js/5.5a6e8292.js"><link rel="prefetch" href="/docs/assets/js/6.f2a77fb2.js"><link rel="prefetch" href="/docs/assets/js/7.da0742e4.js"><link rel="prefetch" href="/docs/assets/js/8.23533285.js"><link rel="prefetch" href="/docs/assets/js/9.c8fa19ee.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.318dbe0e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Desgin To Release Workflow</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/design-to-release" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/design-to-release" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/docs/language.html" class="sidebar-link">设计语言</a></li><li><a href="/docs/assets.html" class="sidebar-link">设计资产</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工作流程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术标准</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>内置特性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>模式适配</span> <span class="arrow down"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>设备适配</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>版本管理</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>最佳实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基于Skecth的设计工具</span> <!----></p> <!----></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基于Adobe XD的设计工具</span> <!----></p> <!----></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>资产管理平台</span> <!----></p> <!----></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>持续集成平台</span> <!----></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基于OSX开发Skecth插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/guide/00-intro.html" class="sidebar-link">前言</a></li><li><a href="/docs/guide/01-startup.html" class="sidebar-link">Sketch插件与NA混合开发基础</a></li><li><a href="/docs/guide/02-oc-basis.html" class="sidebar-link">Cocoa 框架概述</a></li><li><a href="/docs/guide/03-cocoa.html" aria-current="page" class="active sidebar-link">OSX开发入门和OC基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guide/03-cocoa.html#新建app工程并编译运行" class="sidebar-link">新建app工程并编译运行</a></li><li class="sidebar-sub-header"><a href="/docs/guide/03-cocoa.html#新建并使用framework" class="sidebar-link">新建并使用framework</a></li><li class="sidebar-sub-header"><a href="/docs/guide/03-cocoa.html#oc语法" class="sidebar-link">OC语法</a></li><li class="sidebar-sub-header"><a href="/docs/guide/03-cocoa.html#相关资料" class="sidebar-link">相关资料</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>发布信息</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="osx开发入门和oc基础"><a href="#osx开发入门和oc基础" class="header-anchor">#</a> OSX开发入门和OC基础</h1> <h2 id="新建app工程并编译运行"><a href="#新建app工程并编译运行" class="header-anchor">#</a> 新建app工程并编译运行</h2> <h3 id="新建osx应用程序"><a href="#新建osx应用程序" class="header-anchor">#</a> 新建OSX应用程序</h3> <p>点击&quot;Create a new Xcode project&quot;创建一个新的项目：
<img src="/docs/assets/img/create-new-1.5c12fb45.png" alt="create a new Xcode project 1">
选择macapp标签下的app，并点击next：
<img src="/docs/assets/img/create-new-2.c4db33f8.png" alt="create a new Xcode project 2">
语言选择Object-C，User Interface 选择XIB，可按需选择是否包含UI Test和Unit Test：
<img src="/docs/assets/img/create-new-3.9ff432ee.png" alt="create a new Xcode project 3">
此时Demo会生成，执行一次构建(快捷键CMD + B)，即可在Products文件夹(在Xcode工程中叫Group)下看到编译好的app，双击即可运行：
<img src="/docs/assets/img/create-new-preview.8b7f2dc8.png" alt="create a new Xcode project preview"></p> <h3 id="工程结构"><a href="#工程结构" class="header-anchor">#</a> 工程结构</h3> <p>目前所有的代码都是默认创建的代码，源码的主要结构如下：<br> <img src="/docs/assets/img/create-new-structure.ae80a8c5.png" alt="project structure"><br>
核心文件：</p> <ul><li>main.m。程序入口文件。</li> <li>AppDelegate.h。NSApplication委托对象的头文件</li> <li>AppDelegate.m。NSApplication委托对象的实现</li> <li>MainMenu.xib。主视图文件</li> <li>Info.plist。运行时使用的配置文件</li></ul> <h3 id="主要代码文件之间的关系"><a href="#主要代码文件之间的关系" class="header-anchor">#</a> 主要代码文件之间的关系</h3> <p>点击工程导航目录的根节点，可以在General配置中看到Deployment Info的Main Interface值为MainMenu，即上文提到的MainMenu.xib为我们的应用程序的主用户界面，app启动运行时，会先去加载该视图。
<img src="/docs/assets/img/build-target.4659f209.png" alt="build target"><br>
MainMenu.xib绑定了一个AppDelegate自定义controller，xib视图初始化的时候会实例化一个AppDelegate Controller。
<img src="/docs/assets/img/xib-objects.8a46ee13.png" alt="xib objects"><br>
在AppDelegate.m文件中，点击代码行号上的圆点，也可以看到AppDelegate接口的window属性也绑定了MainMenu.xib
<img src="/docs/assets/img/app-delegate.27e000e8.png" alt="app-delegate"></p> <h2 id="新建并使用framework"><a href="#新建并使用framework" class="header-anchor">#</a> 新建并使用framework</h2> <h3 id="新建自定义的framework"><a href="#新建自定义的framework" class="header-anchor">#</a> 新建自定义的framework</h3> <p>同新建APP类似，以OSX的framework为例，新建framework的时候，选择<a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/OSX_Technology_Overview/SystemFrameworks/SystemFrameworks.html" target="_blank" rel="noopener noreferrer">Framework<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>分类即可：
<img src="/docs/assets/img/framework-1.baff2659.png" alt="framework-1"><br>
我们新建一个简单的MyLog Cocoa类，会生成对应的.h和.m文件，声明并实现log接口：<br> <img src="/docs/assets/img/framework-api.e7db28fb.png" alt="framework-api">
然后在新建Framework时自动生成的头文件中，导入我们刚刚创建的接口的头文件：<br> <img src="/docs/assets/img/framework-import.7b55ba8e.png" alt="framework-import">
在framework的target的Build Phases中，将我们的Mylog.h拖动到Headers中的Public列表下，将接口暴露给外部：<br> <img src="/docs/assets/img/framework-build-phase.e96b79e4.png" alt="framework-build">
此时，编译项目（快捷键CMD + B），即可编译我们的framework。文件树的Producsts下就是编译产物。</p> <h3 id="使用自定义的framework"><a href="#使用自定义的framework" class="header-anchor">#</a> 使用自定义的framework</h3> <p>使用时，以在上面新建的Demo App使用framework为例，将编译好的framework拖到Demo App中。
在项目配置中，Build Phase选项的“Link Binary With Libraries”里加入目标framework。
<img src="/docs/assets/img/framework-use-1.5cfda8c3.png" alt="framework-use">
在项目配置中，General选项下添加我们的framework并嵌入
<img src="/docs/assets/img/framework-use-2.7096a7fa.png" alt="framework-use 2"></p> <h3 id="新建sketch-framework"><a href="#新建sketch-framework" class="header-anchor">#</a> 新建sketch framework</h3> <p>使用sketch官方提供的插件管理器——<a href="https://github.com/skpm/skpm" target="_blank" rel="noopener noreferrer">skpm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>可以创建sketch插件。<br>
环境要求：</p> <ul><li>osx command line tool</li> <li>Node &gt; V6.x
安装：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -g skpm
</code></pre></div><p>创建sketch插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>skpm create plugin-name
</code></pre></div><p>新创建的插件源码文件结构如下：
<img src="/docs/assets/img/plugin-structure.290ce5ff.png" alt="sketch plugin source"><br>
manifest.json为整个插件的声明文件，内容如下：
<img src="/docs/assets/img/manifest.4fbefd8b.png" alt="sketch plugin source"></p> <p>commands代表插件可触发的命令，每个command的script即是这个命令触发时运行的代码入口文件。menu是新建的插件在sketch菜单栏中相关配置。<a href="https://developer.sketch.com/plugins/create-a-plugin" target="_blank" rel="noopener noreferrer">sketch开发文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>介绍了demo插件的文件结构和说明，本文不再详细介绍。<br>
插件安装完毕后，插件会自动build一次，打开sketch即可运行新建的demo插件。下图中插件名“my-plugin”对应manifest中的menu.title，“my-command”对应manifest的command name：
<img src="/docs/assets/img/demo-plugin.ae67b031.png" alt="demo plugin"><br>
后续我们会推出在CocoaJS中引入framework开发插件的进阶教程。</p> <h2 id="oc语法"><a href="#oc语法" class="header-anchor">#</a> OC语法</h2> <h3 id="使用foudation框架内的数据类型"><a href="#使用foudation框架内的数据类型" class="header-anchor">#</a> 使用Foudation框架内的数据类型</h3> <p>OC可以使用C语言自带的数据类型，并且在C的基础上通过框架（如Foudation）进行了拓展。通过“#import &lt;Foudation/Foudation.h&gt;”语句可以导入OC的基本功能层中定义的常用数据类型（如NSNumber、NSString等），
这些类型的根对象类是（NSObject），数据类型名都以NS开头。Foudation工具包来源于NextSTEP，NS前缀名出自这里。我们日常使用OC开发Sketch插件时，主要使用这些NSObject。</p> <h3 id="布尔类型"><a href="#布尔类型" class="header-anchor">#</a> 布尔类型</h3> <p>C语言的布尔类型bool具有true、false两个值，OC也提供了相似的布尔类型BOOL，具有YES和NO两个值。这两种类型可以在同一程序中共存，Cocoa代码主要使用BOOL。
BOOL本质上是8位有符号字符，通过#define命令定义YES是1，NO是0。如果把大于1字节的值传给BOOL变量，而该值低位字节恰好为0，则该BOOL值为NO。而对于bool类型，非0即为true。</p> <h3 id="oc类"><a href="#oc类" class="header-anchor">#</a> OC类</h3> <h4 id="声明和使用一个自定义类"><a href="#声明和使用一个自定义类" class="header-anchor">#</a> 声明和使用一个自定义类</h4> <p>@interface关键字可以声明类的类型信息：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@interface</span> Person NSObject
<span class="token punctuation">{</span>
    NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> getName<span class="token punctuation">;</span>
</code></pre></div><div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@implementation</span> Person NSObject
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> getName <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码第一行代表新类Person继承（用:表示）自NSObject，第三行代表Person类有一个name实例变量。第五行代表Person类有一个示例方法getame。
@implementtation部分代表Person类的实现部分，这里直接在getName方法中返回了实例变量name。<br>
类的方法声明中，以-开头，代表的是实例方法，以+开头代表的是静态方法。
如果需要使用一个新的Person对象，首先需要执行对象的分配（alloc）和初始化（init），alloc用于分配新的内存空间，init用于调用对象的初始化方法：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>Person <span class="token operator">*</span>person <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>Person alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>也可以使用其他自定义的初始化方法初始化对象，比如：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>NSNumber <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSNumber alloc<span class="token punctuation">]</span> initWithDouble<span class="token punctuation">:</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>也可以通过new关键字等价完成alloc和init操作（new 默认调用init方法）：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code>Person <span class="token operator">*</span>person <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>Person new<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="方法调用和中缀符"><a href="#方法调用和中缀符" class="header-anchor">#</a> 方法调用和中缀符</h4> <p>中括号代表调用函数或方法，链式的方法调用可以通过嵌套中括号实现。冒号后可传递参数。OC使用中缀符的语法技术，方法的名称和参数是连载一起的：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token punctuation">[</span>NSColor colorWithRed<span class="token punctuation">:</span><span class="token number">0</span> green<span class="token punctuation">:</span><span class="token number">0</span> blue<span class="token punctuation">:</span><span class="token number">0</span> alpha<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>相比于常见的方法调用方式，这种方式的可读性更强一些，参数代表的意义变成了函数名的一部分。</p> <h4 id="存取方法和属性"><a href="#存取方法和属性" class="header-anchor">#</a> 存取方法和属性</h4> <p>OC也可以定义存取（accessor）。Cocoa的惯例是：setter方法是在属性的前面加set前缀命名，getter方法直接以返回的属性名称来命名。为Person类增加存取函数：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@interface</span> Person NSObject
<span class="token punctuation">{</span>
    NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> name<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> setName<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> newName<span class="token punctuation">;</span>
</code></pre></div><div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@implementation</span> Person NSObject
<span class="token punctuation">{</span>
    NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 此时我们使用了self，作用与未使用一样，只是为了消除歧义。</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> name <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> setName<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> newName<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>oc提供了@property简化代码：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@interface</span> Person NSObject
<span class="token keyword">@property</span> <span class="token punctuation">(</span>assign<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
</code></pre></div><div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@implementation</span> Person NSObject
<span class="token keyword">@synthesize</span> name<span class="token punctuation">;</span>
</code></pre></div><p>@synthesize是编译器的功能，编译器遇到该指令，会自动添加实现存取函数的预编译代码。同时原来方括号内的实例变量的声明已可有可无。<br>
属性类型前的括号代表属性指示符，用于告知编译器属性的一些特性。常用的属性指示符：</p> <ul><li>assign。该指示符号对属性只是简单的赋值，不更改引用计数</li> <li>atomic、nonatomic：指定setter和getter是否是原子操作，即是否线程安全。</li> <li>copy：如果使用copy指示符，当调用setter方法对成员变量赋值时，会将被赋值的对象复制的一个副本，再将该副本给成员变量。</li> <li>readonly、readwrite：readonly指示系统只合成getter方法，不合成setter方法；readwrite是默认值，指示系统需要合成setter方法和getter方法。</li> <li>retain：当把某个对象赋值给该属性时，该属性原来所引用的对象的引用计数减1，被赋值对象的引用计数加1。在未启用ARC机制的的情况下，retain可以保证一个对象的引用计数大于1时，该对象不会被回收。启用ARC后基本用Strong代替retain</li> <li>strong、weak：strong指示符该属性对被赋值对象持有强引用，而weak指示符指定该属性对被赋值对象持有弱引用。ARC（自动引用计数）不会为弱引用增加计数，引用对象被回收时，弱引用会被自动置为nil。</li></ul> <h3 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h3> <p>上面有关属性支持符的描述，已经涉及了编程语言都需要关注的问题——内存管理。Cocoa使用引用计数技术来计算对象生命周期是否结束，当某段代码需要访问内存中某个对象时，对该对象的保留计数器加1，结束访问时对该对象的保留计数器减1。
Cocoa提供了一些内存管理的机制，下面一一介绍</p> <h4 id="mrc"><a href="#mrc" class="header-anchor">#</a> MRC</h4> <p>Cocoa中，使用alloc、new、copy消息创建对象时，对象的保留计数器值为1，通过retain、release、dealloc、retainCount消息可以操作保留计数器的值：</p> <ul><li>retain。增加对象的保留计数器的值。</li> <li>release。减少对象的保留计数器的值。</li> <li>retainCont。获取当前对象的保留计数器的值。</li> <li>dealloc。当一个对象因为保留计数器归0要被销毁时，OC会自动向该对象发送一条dealloc消息，该指令不要直接调用，可以重写并释放自己的资源
以下代码可以测试这几个指令的效果：</li></ul> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@interface</span> MRC<span class="token punctuation">:</span> NSObject
<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> MRC
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> init <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> init<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;init：%lu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">self</span> retainCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> dealloc <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;dealloc called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> dealloc<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">@end</span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MRC m <span class="token operator">=</span> <span class="token punctuation">[</span>MRC new<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>m retainCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>m retain<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// count 2</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>m retainCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>m release<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// count 1</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>m retainCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>m release<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// count 0, dealloc</span>
<span class="token punctuation">}</span>

</code></pre></div><p>对于MRC模式下，Cocoa有一些内存管理约定：</p> <ul><li>使用new、alloc、copy创建对象，对象保留计数器为1.不再使用时应该对其发送release或autorelease消息。</li> <li>其他方法创建，如果是临时对象（并没有对该对象保留），则不需要管，如果保留了对象，则需要在dealloc中释放。</li> <li>如果保留了某个对象，就需要释放或自动释放。需要保持retain的次数=release的次数。</li></ul> <h4 id="autorelease-pool"><a href="#autorelease-pool" class="header-anchor">#</a> autorelease pool</h4> <p>在MRC中，需要手动管理对象所有权的管理和释放，实际开发使用的时候会非常麻烦。《Objective-C基础教程》9.1.3有如下demo：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> setEngine<span class="token punctuation">:</span> <span class="token punctuation">(</span>Engine <span class="token operator">*</span><span class="token punctuation">)</span> e<span class="token punctuation">{</span>
    engine <span class="token operator">=</span> <span class="token punctuation">[</span>e retain<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// engine1的引用计数变化</span>
Engine <span class="token operator">*</span>engine1 <span class="token operator">=</span> <span class="token punctuation">[</span>Engine new<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token punctuation">[</span>car setEngine<span class="token punctuation">:</span> engine1<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">[</span>engine1 release<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><p>上述代码在主程序释放了engine1的时候，car并没有释放对engine1的引用，此时engine1发生内存泄露。赋值时需要先释放对旧对象的引用，书中提供了修复方式：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> setEngine<span class="token punctuation">:</span> <span class="token punctuation">(</span>Engine <span class="token operator">*</span><span class="token punctuation">)</span> e<span class="token punctuation">{</span>
    <span class="token punctuation">[</span>e retain<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>engine release<span class="token punctuation">]</span><span class="token punctuation">;</span>
    engine <span class="token operator">=</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Cocoa提供了自动释放池(autorelease pool)来方便开发者在MRC模式下进行内存管理，其会在销毁时对自动释放池内的对象调用release消息。
release是对当前对象的引用计数进行减1的操作，如果对象引用计算为0，则会释放对象的内存空间。
NSObject类提供了一个autorelase实例方法，MRC模式下可手动调用该方法，将其放入自动释放池中。iOS开发中不建议使用autorelease
通过以下两种方式可以创建自动释放池：</p> <ul><li>@autoreleasepool关键字</li> <li>NSAutoreleasePool对象</li></ul> <h4 id="arc"><a href="#arc" class="header-anchor">#</a> ARC</h4> <p>ARC是编译器的一种特性，不是内存管理机制。他会在编译的时候，在代码中合适的位置插入retain和release。而不再需要手动retain、release、autorelease。
ARC使用strong替代retain，引入了weak弱引用。可以在Build Setting中搜gar，设置启用ARC：
<img src="/docs/assets/img/arc-only.0bf0d889.png" alt="arc-only"><br>
ARC只对可保留的对象指针（ROPs）有效，ROPs主要有以下三种：</p> <ol><li>代码块指针</li> <li>OC对象指针</li> <li>通过__attribute__((NSObject))类型定义的指针</li></ol> <p>如CFStringRef不支持ARC，但是可以同时使用ARC和MRC。设置方法是，Build Phase中的Compile Sources中选择要使用ARC的.m文件，双击Compiler Flags选项，输入要设置的模式：</p> <ul><li>ARC状态下使用MRC的文件使用-fno-objc-arc</li> <li>MRC状态下使用ARC的文件使用-fobjc-arc
<img src="/docs/assets/img/arc.89141106.png" alt="arc">
使用ARC时需要注意两个规则：</li> <li>属性名不能以new开头</li> <li>属性不能只有一个readonly而没有管理特性，因为默认的特性是assign，而ARC要求声明属性的所有权</li></ul> <h2 id="相关资料"><a href="#相关资料" class="header-anchor">#</a> 相关资料</h2> <ol><li><a href="https://macdev.io/ebook/start.html" target="_blank" rel="noopener noreferrer">xcode 界面使用介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/skpm/skpm" target="_blank" rel="noopener noreferrer">skpm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.sketch.com/plugins/cocoascript" target="_blank" rel="noopener noreferrer">CocoaScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.sketch.com/reference/api/" target="_blank" rel="noopener noreferrer">Sketch API Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://book.douban.com/subject/3864073/" target="_blank" rel="noopener noreferrer">Objective-C基础教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://book.douban.com/subject/30815894/" target="_blank" rel="noopener noreferrer">Cocoa学习手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/19/2021, 11:39:10 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/guide/02-oc-basis.html" class="prev">
        Cocoa 框架概述
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.7c0eddc4.js" defer></script><script src="/docs/assets/js/2.fb0ab628.js" defer></script><script src="/docs/assets/js/3.1ec2467f.js" defer></script>
  </body>
</html>
